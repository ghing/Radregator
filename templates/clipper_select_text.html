<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:fb="http://www.facebook.com/2008/fbml">
  <head>
    {% autoescape off%}
    {{requested_page_head}}
    {% endautoescape%}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>radregator</title>
    <link rel="stylesheet" href="{{ MEDIA_URL }}css/demo.css">
    <link rel="stylesheet" href="{{ MEDIA_URL }}css/jquery-ui-1.8.6.custom.css">
    <script src="{{ MEDIA_URL }}js/jquery.tools.min.js"></script>
    <script src="{{ MEDIA_URL }}js/jquery.colorbox-min.js"></script>
    <script src="{{ MEDIA_URL }}js/jquery-ui-1.8.6.custom.min.js"></script>
<style type="text/css">
.clipper_i_am{
}
.clipper_form{
}
.clipper_text_field{
display:block;
}
.textarea1{
float:left;
}
.clipper_header{
font-size:30px;
}
</style>
<script type="text/javascript">

    if(!window.radregator){
        radregator = {};
    }

    radregator.select = {};

    function toggleItem(id){
      var item = document.getElementById(id);
      if(item){
        if ( item.style.display == "none"){
          item.style.display = "";
        }
        else{
          item.style.display = "none";
        } 
      }
    }


    //Want to make sure something in the selection has been filled in
    //because if we let django forms do it, we'll have to save the page
    //we harvested into a temp location and load it back out 
    //by checking here we can forefront that process and save a page load
    radregator.select.checkSelectionForm = function(){
      var s_text = $("#id_selected_text").val();
      if(s_text == ''){
        alert('Please highlight some text that relates to the comment you are responding to before submitting.');
        return false;
      }

    }

    radregator.select.getSelected = function(){
      var txt = '';
      if (window.getSelection){
        txt = window.getSelection();
      }
      else if (document.getSelection){
        txt = document.getSelection();
      }
      else if (document.selection){
        txt = document.selection.createRange().text;
      }
      else return;
      return txt;
    }


    radregator.select.mouseup = function(){
        var st = radregator.select.getSelected();
        if(st!=''){
          $("#id_selected_text").val(st);
        }
    }

    $(function() {
        $( "#id_date_published" ).datepicker();
      });

    $(document).ready(function(){
        $(document).bind("mouseup", radregator.select.mouseup);
        $(document).bind("submit", radregator.select.checkSelectionForm);
        $("#clipper_i_am").hide();
    });

    function toggleForms(){
      if($("#clipper_i_am").is(":visible")){
        $('#clipper_i_am').hide();
        $('a#expand_link').text("SHOW FORMS");
      }
      else{
        $("#clipper_i_am").show('drop')
        $('a#expand_link').text("HIDE FORMS");
      }
    }
</script>

</head>
  <body>
  <div id="clipper_header" style="background:white;font-family:arial;font-size:12px;color:black";>
    <h1>So, you want to attach an article?</h1>
  <br>
  <b>The page should appear just a little bit below all of these confusing forms.  We'd like to attribute everything to a source and a reporter, so we tried to identify that stuff but I'm not totally confident it worked.  First, highlight text in this article that you think is most pertinent and relates to a question or a comment.  Then, if you have time, check over the other fields and fix what we got wrong.  Gracias.</b>
  </div>
  <div id="clipper_i_am" style="background:white;font-family:arial;font-size:12px;color:black;position:fixed;width:55%;float:left;z-index:1000;">
    <form name="form1" class='clipper_form' method='POST' action='/clipper_select'>
    <div id='textarea1' class='textarea1'>
    {{form.selected_text.errors}}
    <label for="id_selected_text">Any text you select in the article will appear here</label>
    {{form.selected_text}}
    </div>
    <div id='textarea2' class='textarea2'>
    {{form.user_comments.errors}}
    <label for="id_user_comments">Does your selection need some more context?  Add it here...</label>
    {{form.user_comments}}
    </div><BR>
    {{form.title.errors}}
    <label for="id_title">Does this look like the articles title?  If not, mind fixing it for us?</label>
    {{form.title}}
    <BR>
    {{form.author.errors}}
    <label for="id_author">This person isn't the author of the article, is it?  We'd be much obliged if you can check for us</label>
    {{form.author}}
    <BR>
    {{form.date_published.errors}}
    <label for="id_date_published">I'll be honest, dates are hard for us.  Mind telling us when this article was published?</label>
    <BR>
    {{form.date_published}}
    <BR>
    {{form.comment_id_field}}
    {{form.url_field}}
    {% csrf_token %} 
    <input type="submit" class="btn" value="Go!" />

    </form>

  </div>
  <div id="clipper_expand" style="border:1px solid black;background:white;font-family:arial;font-size:12px;color:black;"><a id='expand_link' href="javascript:toggleForms()">SHOW FORMS</a></div>
<BR> 

<div class="" id="requested_page" >
{% autoescape off %}
{{requested_page_body}}
{% endautoescape %}


</div>
  </body>
</html>
