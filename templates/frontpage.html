{% extends "base.html" %}

{% block pagetitle %}
	Questions Interaction v0.1
{% endblock %}

{% block addscripts %}
<script type="text/javascript">
	
		$(document).ready(function() {
			$('a.commenttabs').unbind('click', handleReplyform).bind('click', handleReplyform); 
            $('.youagree a').unbind('click', handleResponseLink).bind('click', handleResponseLink);
			
			// DEAL WITH INDENTED COMMENTS
			$('li.comment-level2').before('<li class="childcomment"></li>');
			$('li.comment-level3').before('<li class="childcomment indent1"></li>');
			$('li.comment-level4').before('<li class="childcomment indent2"></li>');
		});
</script>
{% endblock %}





{% block body %}
	<div id="introblurb">
		<h3>Welcome</h3>
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum ac elit nec lectus imperdiet tincidunt. Morbi neque nisl, tincidunt cursus molestie in, eleifend at dui. Fusce lorem diam, condimentum ac luctus at, tincidunt sit amet neque. Sed imperdiet mollis diam, et lobortis velit feugiat at.</p>
	</div>	
	
	<ul class="tabs">
		{% for topic in topics.all %}
			<li><a href="#" class="switchtab">{{ topic.title }}</a></li>
		{% endfor %}
	</ul>
	
	<div class="panes">
	
	{% for thetopic in topics.all %}
	<div>
		<h2>{{ thetopic.title }}</h2>
		
		<p>{{ thetopic.summary.text }}</p>
			
		<h4>Local Coverage</h4>
		
		
		<ul class="coverage">
		{% for article in thetopic.articles.all %}
			<li>
				<a href="{{ article.url }}">{{ article.title }}</a>
			</li>
		{% endfor %}
		</ul>
			
			
	{% include "form.html" %}				
	
	<h2>Recent Questions</h2>
		<ul class="recentquestcons">
			{% for comment, indentlevel in thetopic.comments_to_show %}
				<li class="comment comment-level{{indentlevel}} {{comment.comment_type.name|lower}}" id="comment-{{comment.id}}">
					<ul class="commentguts">
						<li class="bbq"><p class="valign">{{ comment.text }}</p></li>
						<li class="youagree"><a href="#">Me too!</a></li>
						<li class="response-counter"><span class="count">{{ comment.responses.count }}</span><span class="description">Ask this too</span></li>
						<li class="chef">by <span>{{ comment.user }}</span></li>
					</ul>
					<a href="#" class="attach commenttabs">Attach an article</a>
					<a href="#" class="reply commenttabs">Reply</a>
					<div class="replydiv replyinputdiv"></div>
					<div class="attachdiv replyinputdiv"></div>
				</li>
                    {% if comment.clips.all %}
                    {% for clip in comment.clips.all %}
                    <li class="comment comment-level{{indentlevel|add:"1"}} {{comment.comment_type.name}}" id="comment-{{comment.id}}" style="border-style:solid;border-color:#ff0000 #0000ff;">
                        <ul class="commentguts">
                            <li class="bbq"><p class='valign'>{{ clip.text }} __ </p></li>
                            <li class="bbq"><p class='valign'><a href="{{ clip.article.url }}"> || link</a></p></li>
                            <li class="bbq"><p class='valign'> ... Posted by: {{ clip.user}}</p></li>
                        </ul>
                    </li>
                    {% endfor %}
                    {% endif %}
			{% empty %}
    			<li><p class="bbq">This topic has no related questions, yet.</p></li>
			{% endfor %}
		</ul>
	
	
		<!--<div class="moreline">
			<a href="#">( prev )</a> <a href="#">( next )</a>
		</div>-->
	
		<div class="formcache">
		    <div id="replyform">
			    <form action = "/api/json/comments/submit/" method="post" class="authcheck">
			   <!-- {{ reply_form.as_p }} -->
			    <label>Reply: </label>
				{{comment_form.text}}
				<input type="hidden" value="3" name="comment_type_str">
				<input type="hidden" value="3" name="in_reply_to" id="id_in_reply_to">
				<input type="hidden" value="" name="topic" class="topic">
				{% csrf_token %}
				<input type="submit" name="submit" class="replysubmit" value="Submit" />
			    </form>
		    </div>
		    
		    <div id="attachform">
				<form action = "/clipper/" method="post" class="authcheck">
					<label>Enter a URL: </label>
					{{clipper_url_form.url_field}}
		<!--			<input type="hidden" value="3" name="comment_type_str">
					<input type="hidden" value="3" name="id_in_reply_to" id="id_in_reply_to"> -->
					{% csrf_token %}
					<input type="submit" name="submit" class="replysubmit" value="Submit" />
			    </form>    
		   </div>
		</div>
	
	</div>

{% endfor %}
</div><!--END PANES CONTAINER-->

{% endblock %}


