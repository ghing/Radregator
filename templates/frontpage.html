{% extends "base.html" %}

{% block pagetitle %}
	Questions Interaction v0.1
{% endblock %}


{% block body %}
	<div id="introblurb">
		<h3>Welcome</h3>
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum ac elit nec lectus imperdiet tincidunt. Morbi neque nisl, tincidunt cursus molestie in, eleifend at dui. Fusce lorem diam, condimentum ac luctus at, tincidunt sit amet neque. Sed imperdiet mollis diam, et lobortis velit feugiat at.</p>
	</div>	
	
	<ul class="tabs">
		{% for topic in topics.all %}
			<li><a href="#" class="switchtab">{{ topic.title }}</a></li>
		{% endfor %}
	</ul>
	
	<div class="panes">
	
	{% for thetopic in topics.all %}
	<div>
		<h2>{{ thetopic.title }}</h2>
		
		<p>{{ thetopic.summary.text }}</p>
			
		<h4>Local Coverage</h4>
		
		
		<ul class="coverage">
		{% for article in thetopic.articles.all %}
			<li>
				<a href="{{ article.url }}">{{ article.title }}</a>
			</li>
		{% endfor %}
		</ul>
			
			
	{% include "form.html" %}			
	
	<script type="text/javascript">
	
		// CLOSE REPLY FUNCTION
		function closeReplyform (replytype,parentid) {
			$("#"+parentid+" div."+replytype+"div").animate({
				height: 0,
				overflow: 'hidden'
			}, 150, function() {
				$("#"+parentid+" div."+replytype+"div").html("").removeClass("opened");
			});
		}
					
		// OPEN REPLY FUNCTION
		function openReplyform (replytype,parentid) {				
			//$("div#"+replytype+"form").append('YO!');
						
			var contents = $("div#"+replytype+"form").html();
			
			$("#"+parentid+" div."+replytype+"div").animate({
				height: "100px",
				overflow: 'hidden'
			}, 150, function() {
				$("#"+parentid+" div."+replytype+"div").html(contents).addClass("opened");
				$("#"+parentid+" div."+replytype+"div").append('<a href="javascript:closeReplyform(\''+replytype+'\',\''+parentid+'\');" class="closereply">close</a>');

			});
		}
	
		$(document).ready(function() {
			
			$("a.commenttabs").click(function() {
				if (docready == "complete") {return false;}
				
				var parentid = $(this).closest("li.comment").attr("id");
				
				if ($(this).hasClass("attach")) { var replytype = "attach"; }
					else { var replytype = "reply"; }
									
				var docready = "complete";
				
				if ($("."+replytype+"div").hasClass("opened")) {
					closeReplyform(replytype,parentid);
					return false;
				}

				openReplyform(replytype, parentid);	
				return false;	
			});
			
		});
	
	
	</script>		
	
	<h2>Recent Questions & Concerns</h2>
		<ul class="recentquestcons">
			{% for comment, indentlevel in thetopic.comments_to_show %}
				<li class="comment comment-level{{indentlevel}} {{comment.comment_type.name|lower}}" id="comment-{{comment.id}}">
					<ul class="commentguts">
						<li class="bbq"><p class="valign">{{ comment.text }}</p></li>
						<li class="youagree"><a href="#">Me too!</a></li>
						<li class="response-counter"><span class="count">{{ comment.responses.count }}</span><span class="description">Ask this too</span></li>
						<li class="chef">by <span>{{ comment.user }}</span></li>
					</ul>
					<a href="#" class="attach commenttabs">Attach an article</a>
					<a href="#" class="reply commenttabs">Reply</a>
					<div class="replydiv replyinput"></div>
					<div class="attachdiv replyinput"></div>
				</li>
			{% empty %}
    			<li><p class="bbq">This topic has no related questions, yet.</p></li>
			{% endfor %}
		</ul>
	
	
		<!--<div class="moreline">
			<a href="#">( prev )</a> <a href="#">( next )</a>
		</div>-->
	</div>

    <div id = "replyform">
	    <form action = "/api/json/comments/submit/" method="post">
	   <!-- {{ reply_form.as_p }} -->
		{{comment_form.text}}
		<input type="hidden" value="3" name="comment_type_str">
		{% csrf_token %}
		<input type="submit" name="submit" class="submit" value="Submit" />
	    </form>
    </div>
    
    <div id="attachform">
    
    <iframe src ="clipper.html" width="100%" height="300">
    <p>Your browser does not support iframes.</p>
    </iframe>        

    </form>
    </div>

{% endfor %}
</div><!--END PANES CONTAINER-->

{% endblock %}


